<!-- topic-management.component.html -->
<div class="topic-management">
  <!-- Header Section -->
  <div class="topic-management__header">
    <nz-card nzTitle="Quản lý chủ đề học tiếng Nhật" class="topic-management__header-card">
      <div class="topic-management__header-content">
        <div class="topic-management__search-section">
          <nz-input-group nzSuffix class="topic-management__search-input">
            <input 
              type="text" 
              nz-input 
              placeholder="Tìm kiếm chủ đề..." 
              [(ngModel)]="searchValue"
              (input)="onSearch()"
            />
            <!-- <nz-input-group-slot nzSuffix>
              <i nz-icon nzType="search"></i>
            </nz-input-group-slot> -->
          </nz-input-group>
        </div>
        
        <div class="topic-management__actions">
          <button 
            nz-button 
            nzType="primary" 
            nzSize="default"
            (click)="showAddModal()"
            class="topic-management__add-btn"
          >
            <i class="fas fa-plus"></i>
            Thêm chủ đề mới
          </button>
        </div>
      </div>
    </nz-card>
  </div>

  <!-- Table Section -->
  <div class="topic-management__table">
    <nz-card class="topic-management__table-card">
      <nz-table 
        #basicTable 
        [nzData]="filteredTopics" 
        [nzLoading]="isLoading"
        nzBordered
        nzSize="middle"
        [nzPageSize]="10"
        [nzShowSizeChanger]="true"
        [nzPageSizeOptions]="[10, 20, 50]"
        class="topic-management__table-content"
      >
        <thead>
          <tr>
            <th nzWidth="50px">#</th>
            <th nzWidth="200px">Tên chủ đề</th>
            <th>Mô tả</th>
            <th nzWidth="80px">Cấp độ</th>
            <th nzWidth="100px">Trạng thái</th>
            <th nzWidth="100px">Số bài học</th>
            <th nzWidth="120px">Ngày tạo</th>
            <th nzWidth="150px">Thao tác</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let topic of basicTable.data; let i = index">
            <td>{{ i + 1 }}</td>
            <td>
              <div class="topic-management__topic-name">
                <i class="fas fa-book-open topic-management__topic-icon"></i>
                {{ topic.name }}
              </div>
            </td>
            <td>
              <div class="topic-management__description">
                {{ topic.description }}
              </div>
            </td>
            <td>
              <nz-tag [nzColor]="getLevelColor(topic.level)">
                {{ topic.level }}
              </nz-tag>
            </td>
            <td>
              <nz-tag [nzColor]="getStatusColor(topic.status)">
                {{ getStatusText(topic.status) }}
              </nz-tag>
            </td>
            <td>
              <div class="topic-management__lessons-count">
                <i class="fas fa-file-alt"></i>
                {{ topic.lessonsCount }}
              </div>
            </td>
            <td>
              <div class="topic-management__date">
                {{ topic.createdAt | date:'dd/MM/yyyy' }}
              </div>
            </td>
            <td>
              <nz-space nzSize="small">
                <button 
                  *nzSpaceItem
                  nz-button 
                  nzType="default" 
                  nzSize="small"
                  nzShape="circle"
                  (click)="showEditModal(topic)"
                  nz-tooltip="Sửa"
                  class="topic-management__edit-btn"
                >
                  <i class="fas fa-edit"></i>
                </button>
                <button 
                  *nzSpaceItem
                  nz-button 
                  nzType="primary" 
                  nzDanger
                  nzSize="small"
                  nzShape="circle"
                  nz-popconfirm
                  nzPopconfirmTitle="Bạn có chắc chắn muốn xóa chủ đề này?"
                  nzPopconfirmPlacement="topRight"
                  (nzOnConfirm)="deleteTopic(topic.id)"
                  nz-tooltip="Xóa"
                  class="topic-management__delete-btn"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </nz-space>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </nz-card>
  </div>

  <!-- Modal for Add/Edit Topic -->
  <nz-modal
    [(nzVisible)]="isModalVisible"
    [nzTitle]="modalTitle"
    [nzClosable]="true"
    [nzMaskClosable]="false"
    [nzWidth]="600"
    [nzFooter]="null"
    (nzOnCancel)="handleCancel()"
    class="topic-management__modal"
  >
    <div class="topic-management__modal-content">
      <form nz-form [formGroup]="topicForm" (ngSubmit)="handleSubmit()">
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="name">
            <i class="fas fa-tag"></i>
            Tên chủ đề
          </nz-form-label>
          <nz-form-control 
            [nzSm]="18" 
            [nzXs]="24" 
            nzErrorTip="Vui lòng nhập tên chủ đề (ít nhất 2 ký tự)"
          >
            <input 
              nz-input 
              formControlName="name" 
              id="name" 
              placeholder="Nhập tên chủ đề..."
              class="topic-management__input"
            />
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="description">
            <i class="fas fa-align-left"></i>
            Mô tả
          </nz-form-label>
          <nz-form-control 
            [nzSm]="18" 
            [nzXs]="24" 
            nzErrorTip="Vui lòng nhập mô tả (ít nhất 10 ký tự)"
          >
            <textarea 
              nz-input 
              formControlName="description" 
              id="description" 
              rows="4"
              placeholder="Nhập mô tả chủ đề..."
              class="topic-management__textarea"
            ></textarea>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="level">
            <i class="fas fa-layer-group"></i>
            Cấp độ
          </nz-form-label>
          <nz-form-control [nzSm]="18" [nzXs]="24">
            <nz-select 
              formControlName="level" 
              id="level" 
              nzPlaceHolder="Chọn cấp độ"
              class="topic-management__select"
            >
              <nz-option 
                *ngFor="let option of levelOptions" 
                [nzLabel]="option.label" 
                [nzValue]="option.value"
              >
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="status">
            <i class="fas fa-toggle-on"></i>
            Trạng thái
          </nz-form-label>
          <nz-form-control [nzSm]="18" [nzXs]="24">
            <nz-select 
              formControlName="status" 
              id="status" 
              nzPlaceHolder="Chọn trạng thái"
              class="topic-management__select"
            >
              <nz-option 
                *ngFor="let option of statusOptions" 
                [nzLabel]="option.label" 
                [nzValue]="option.value"
              >
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>

        <nz-divider></nz-divider>

        <nz-form-item class="topic-management__modal-actions">
          <nz-form-control [nzOffset]="6" [nzSm]="18" [nzXs]="24">
            <nz-space nzSize="small">
              <button 
                *nzSpaceItem
                nz-button 
                nzType="default" 
                (click)="handleCancel()"
                class="topic-management__cancel-btn"
              >
                <i class="fas fa-times"></i>
                Hủy
              </button>
              <button 
                *nzSpaceItem
                nz-button 
                nzType="primary" 
                type="submit"
                [nzLoading]="isLoading"
                class="topic-management__submit-btn"
              >
                <i class="fas fa-save"></i>
                {{ editingTopic ? 'Cập nhật' : 'Thêm mới' }}
              </button>
            </nz-space>
          </nz-form-control>
        </nz-form-item>
      </form>
    </div>
  </nz-modal>
</div>